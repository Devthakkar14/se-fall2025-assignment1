container_commands:
  01_ensure_db_dir:
    command: "mkdir -p /var/app/current && chmod 755 /var/app/current"
    leader_only: true
  02_migrate:
    command: "source /var/app/venv/*/bin/activate && cd /var/app/current && python3 manage.py migrate --noinput"
    leader_only: true
  03_collectstatic:
    command: "source /var/app/venv/*/bin/activate && cd /var/app/current && python3 manage.py collectstatic --noinput"
    leader_only: true
  04_verify_db:
    command: "source /var/app/venv/*/bin/activate && cd /var/app/current && python3 -c \"from django.db import connection; cursor = connection.cursor(); cursor.execute('SELECT name FROM sqlite_master WHERE type=\\'table\\' AND name=\\'polls_question\\';'); print('Database tables:', cursor.fetchall())\""
    leader_only: true
